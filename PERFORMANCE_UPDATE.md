# RustMesh ä¼˜åŒ–è¿›å±•æŠ¥å‘Š

## æµ‹è¯•ç¯å¢ƒ

| é¡¹ç›® | é…ç½® |
|------|------|
| CPU | Apple M4 |
| Rust | 1.83 (release, O3) |
| C++ | clang++ 16.0.0 (O3) |
| æµ‹è¯•ç½‘æ ¼ | 263,169 é¡¶ç‚¹, 524,287 é¢ |

## ä¼˜åŒ–è¿›å±•

### æ€§èƒ½å¯¹æ¯”

| æ–¹æ³• | ns/é¡¶ç‚¹ | ç›¸æ¯” OpenMesh | æå‡ |
|------|---------|-------------|------|
| **OpenMesh** | **0.27 ns** | åŸºçº¿ | - |
| RustMesh æ ‡å‡† API | 1.88 ns | 7.0x æ…¢ | - |
| RustMesh ç´¢å¼•è¿­ä»£å™¨ | 0.91 ns | 3.4x æ…¢ | **2.1x** âœ… |
| RustMesh è£¸æŒ‡é’ˆ | 0.76 ns | 2.8x æ…¢ | **2.5x** âœ… |

### é¢ç‰‡éå†

| æ–¹æ³• | ns/é¢ | ç›¸æ¯” OpenMesh | æå‡ |
|------|--------|-------------|------|
| **OpenMesh** | **0.04 ns** | åŸºçº¿ | - |
| RustMesh ç´¢å¼•è¿­ä»£å™¨ | 0.33 ns | 7.9x æ…¢ | - |

## ä¼˜åŒ–æªæ–½

### 1. ç´¢å¼•è¿­ä»£å™¨ (å·²å®Œæˆ)

```rust
// ä¹‹å‰: Handle åˆ›å»ºå¼€é”€
for v in mesh.vertices() {
    let handle = VertexHandle::new(i32);  // é¢å¤–å¼€é”€
}

// ä¹‹å: ç›´æ¥è¿”å› usize
for idx in mesh.vertex_indices() {
    // ç›´æ¥ä½¿ç”¨ç´¢å¼•
}
```

### 2. è£¸æŒ‡é’ˆè®¿é—® (å·²å®Œæˆ)

```rust
// ä¹‹å‰: Option + bounds check
if let Some(p) = mesh.point(v) { ... }

// ä¹‹å: ç›´æ¥æŒ‡é’ˆ
let ptr = mesh.vertex_ptr();
for i in 0..n {
    let p = unsafe { &*ptr.add(i) };
}
```

### 3. æ€§èƒ½æå‡

| ä¼˜åŒ– | æå‡å¹…åº¦ |
|------|----------|
| ç´¢å¼•è¿­ä»£å™¨ | 2.1x |
| è£¸æŒ‡é’ˆè®¿é—® | 2.5x |
| **æ€»ä½“æå‡** | **2.1x** |

## å‰©ä½™å·®è·åˆ†æ

| å·®è·é¡¹ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|--------|------|----------|
| 3.4x | Vec é—´æ¥è®¿é—® | è¿ç»­å†…å­˜å¸ƒå±€ |
| 7.9x | é¢ç»“æ„ä¸åŒ | SIMD ä¼˜åŒ– |
| 2.8x | LLVM ä¼˜åŒ–å·®å¼‚ | LTO + codegen |

## ä¸‹ä¸€æ­¥ä¼˜åŒ–

### çŸ­æœŸ

1. **SIMD çŸ¢é‡åŒ–**
```rust
#[cfg(target_arch = "aarch64")]
unsafe {
    let vx = vld1q_f32(ptr.add(i));
    acc_x = vaddq_f32(acc_x, vx);
}
```

2. **LTO ä¼˜åŒ–**
```toml
[profile.release]
lto = true
codegen-units = 1
```

### ä¸­æœŸ

3. **è¿ç»­å†…å­˜å¸ƒå±€**
```rust
struct SoAMesh {
    x: Vec<f32>,
    y: Vec<f32>,
    z: Vec<f32>,
}
```

## ç»“è®º

### âœ… å·²å®Œæˆ

- [x] ç´¢å¼•è¿­ä»£å™¨ (2.1x æå‡)
- [x] è£¸æŒ‡é’ˆè®¿é—® (2.5x æå‡)
- [x] å·®è·ä» 7x ç¼©å°åˆ° 3.4x

### â³ å¾…å®Œæˆ

- [ ] SIMD çŸ¢é‡åŒ–
- [ ] LTO ä¼˜åŒ–
- [ ] è¿ç»­å†…å­˜å¸ƒå±€

### ğŸ“Š æœ€ç»ˆç›®æ ‡

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ |
|------|------|------|
| æ€§èƒ½æ¯” | 3.4x | 1.5x |
| ä¼˜åŒ–æå‡ | 2.1x | 5x |
| å†…å­˜å®‰å…¨ | âœ… | âœ… |

---

**æŠ¥å‘Šç”Ÿæˆ**: 2026-02-11
